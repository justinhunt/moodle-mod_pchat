define(["jquery","core/log","mod_pchat/definitions","mod_pchat/cloudpoodllloader","mod_pchat/recorderhelper"],(function($,log,def,cloudpoodllloader,recorderhelper){return log.debug("Recorder controller: initialising"),{clone:function(){return $.extend(!0,{},this)},init:function(props){var dd=this.clone(),theid="#amdopts_"+props.widgetid,configcontrol=$(theid).get(0);configcontrol?(dd.activitydata=JSON.parse(configcontrol.value),$(theid).remove(),dd.cmid=props.cmid,dd.recorderid=dd.activitydata.recorderid,dd.updatecontrolid=props.widgetid+def.C_UPDATECONTROL,dd.streamingresultsid=props.widgetid+def.C_STREAMINGCONTROL,dd.is_browser_ok()&&dd.setup_recorder()):log.debug("PChat Recorder Controller: No config found on page. Giving up.")},is_browser_ok:function(){return navigator&&navigator.mediaDevices&&navigator.mediaDevices.getUserMedia},setup_recorder:function(){var dd=this,theform=$(".mod_pchat_step2").find("form"),uploadwarning=$(".mod_pchat_uploadwarning"),recordingcontainer=$(".mod_pchat_recordingcontainer");recorderhelper.init(dd.activitydata,(function(eventdata){dd.activitydata.transcriber==def.transcriber_amazonstreaming&&(dd.streamingresults=[])}),(function(eventdata){uploadwarning.show()}),(function(eventdata){($("#"+dd.updatecontrolid).val(eventdata.mediaurl),dd.activitydata.transcriber==def.transcriber_amazonstreaming&&dd.streamingresults&&dd.streamingresults.length>0)&&$("#"+dd.streamingresultsid).val(JSON.stringify(dd.streamingresults));recordingcontainer.hide()}),(function(eventdata){eventdata.capturedspeech;var speechresults=eventdata.speechresults;dd.activitydata.transcriber==def.transcriber_amazonstreaming&&(dd.streamingresults.push(speechresults),log.debug(dd.streamingresults))}),(function(){uploadwarning.hide(),$(".mod_solo_step2 .btn").attr("disabled","disabled"),$(".mod_pchat_step2 .btn.btn-primary").show(),theform.submit()}))},process_html:function(){this.activitydata;this.controls={}},register_events:function(){}}}));

//# sourceMappingURL=recordercontroller.min.js.map