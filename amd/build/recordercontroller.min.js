define ("mod_pchat/recordercontroller",["jquery","core/log","mod_pchat/definitions","mod_pchat/cloudpoodllloader","mod_pchat/recorderhelper","mod_pchat/transcriber-lazy"],function(a,b,c,d,e,f){"use strict";b.debug("Recorder controller: initialising");return{clone:function clone(){return a.extend(!0,{},this)},init:function init(d){var e=this.clone(),f="#amdopts_"+d.widgetid,g=a(f).get(0);if(g){e.activitydata=JSON.parse(g.value);a(f).remove()}else{b.debug("PChat Recorder Controller: No config found on page. Giving up.");return}e.cmid=d.cmid;e.recorderid=e.activitydata.recorderid;e.updatecontrolid=d.widgetid+c.C_UPDATECONTROL;e.streamingresultsid=d.widgetid+c.C_STREAMINGCONTROL;if(!e.is_browser_ok()){return}e.setup_transcriber();e.setup_recorder()},is_browser_ok:function is_browser_ok(){return navigator&&navigator.mediaDevices&&navigator.mediaDevices.getUserMedia},setup_transcriber:function setup_transcriber(){var a=this;a.streamingresults=!1;var d={language:a.activitydata.language,region:a.activitydata.region,transcriber:a.activitydata.transcriber,token:a.activitydata.token,parent:a.activitydata.parent,owner:a.activitydata.owner,appid:a.activitydata.appid,expiretime:a.activitydata.expiretime,transcriber:a.activitydata.transcriber};if(d.transcriber==c.transcriber_amazonstreaming){f.init(d);f.onFinalResult=function(c,d){a.streamingresults.push(d);b.debug(a.streamingresults)};f.onPartialResult=function(){}}},setup_recorder:function setup_recorder(){var d=this;e.init(d.activitydata,function on_recording_start(){if(d.activitydata.transcriber==c.transcriber_amazonstreaming){if(f.active){return}d.streamingresults=[];window.navigator.mediaDevices.getUserMedia({video:!1,audio:!0}).then(function(a){f.start(a,f)}).catch(function(a){b.debug(a);b.debug("There was an error streaming your audio to Amazon Transcribe. Please try again.")})}},function on_recording_end(){if(d.activitydata.transcriber==c.transcriber_amazonstreaming){if(!f.active){return}f.closeSocket()}},function on_media_processing(b){var e=a("#"+d.updatecontrolid);e.val(b.mediaurl);if(d.activitydata.transcriber==c.transcriber_amazonstreaming&&d.streamingresults&&0<d.streamingresults.length){var f=a("#"+d.streamingresultsid);f.val(JSON.stringify(d.streamingresults))}})},process_html:function process_html(){var a=this.activitydata;this.controls={}},register_events:function register_events(){this}}});
//# sourceMappingURL=recordercontroller.min.js.map
