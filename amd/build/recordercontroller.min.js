define(["jquery","core/log","mod_pchat/definitions","mod_pchat/cloudpoodllloader","mod_pchat/recorderhelper"],function(a,b,c,d,e){"use strict";return b.debug("Recorder controller: initialising"),{clone:function(){return a.extend(!0,{},this)},init:function(d){var e=this.clone(),f="#amdopts_"+d.widgetid,g=a(f).get(0);return g?(e.activitydata=JSON.parse(g.value),a(f).remove(),e.cmid=d.cmid,e.recorderid=e.activitydata.recorderid,e.updatecontrolid=d.widgetid+c.C_UPDATECONTROL,e.streamingresultsid=d.widgetid+c.C_STREAMINGCONTROL,void(e.is_browser_ok()&&e.setup_recorder())):void b.debug("PChat Recorder Controller: No config found on page. Giving up.")},is_browser_ok:function(){return navigator&&navigator.mediaDevices&&navigator.mediaDevices.getUserMedia},setup_recorder:function(){var d=this,f=function(a){d.activitydata.transcriber==c.transcriber_amazonstreaming&&(d.streamingresults=[])},g=function(a){var e=(a.capturedspeech,a.speechresults);d.activitydata.transcriber==c.transcriber_amazonstreaming&&(d.streamingresults.push(e),b.debug(d.streamingresults))},h=function(a){},i=function(b){var e=a("#"+d.updatecontrolid);if(e.val(b.mediaurl),d.activitydata.transcriber==c.transcriber_amazonstreaming&&d.streamingresults&&d.streamingresults.length>0){var f=a("#"+d.streamingresultsid);f.val(JSON.stringify(d.streamingresults))}};e.init(d.activitydata,f,h,i,g)},process_html:function(){var a=(this.activitydata,{});this.controls=a},register_events:function(){}}});