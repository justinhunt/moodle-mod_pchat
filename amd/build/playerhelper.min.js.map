{"version":3,"file":"playerhelper.min.js","sources":["../src/playerhelper.js"],"sourcesContent":["define([\"jquery\", \"mod_pchat/conversationconstants\"], function($, constants) {\r\n\r\n    return {\r\n        controls: {},\r\n\r\n        init: function(mediatype){\r\n           this.initControls(mediatype);\r\n           this.registerEvents();\r\n        },\r\n\r\n        initControls: function(mediatype){\r\n            if(mediatype === constants.mediatype_video) {\r\n                this.controls.mediaPlayer = $(constants.videoplayer);\r\n            }else{\r\n                this.controls.mediaPlayer = $(constants.audioplayer);\r\n            }\r\n            this.controls.playBtn = $(constants.playbutton);\r\n            this.controls.prevBtn = $(constants.prevbutton);\r\n            this.controls.nextBtn = $(constants.nextbutton);\r\n            this.controls.progressBar = $(constants.progressbar);\r\n            this.controls.progressLine = $(constants.progressline);\r\n            this.controls.greenProgress = $(constants.greenprogress);\r\n            this.controls.progressMarker = $(constants.progressmarker);\r\n            this.controls.mediaDuration = 0;\r\n            this.controls.timeTotal = $(constants.timetotal);\r\n            this.controls.timeCurrent = $(constants.timecurrent);\r\n        },\r\n\r\n        toTimeString: function (date) {\r\n            var date = date.toTimeString().split(' ')[0];\r\n            date = date.slice(3, 8);\r\n            return date;\r\n        },\r\n\r\n        moveSlider: function(event) {\r\n\r\n        },\r\n\r\n        stepBack: function() {\r\n            var current = this.controls.mediaPlayer[0].currentTime;\r\n            if (current > 5) {\r\n                current -= 5;\r\n            } else {\r\n                current = 0;\r\n            }\r\n            this.controls.mediaPlayer[0].currentTime = current;\r\n        },\r\n        stepForward: function() {\r\n            var current = this.controls.mediaPlayer[0].currentTime;\r\n            var duration = this.controls.mediaPlayer[0].duration;\r\n            if (current <= (duration - 5)) {\r\n                current += 5;\r\n            } else {\r\n                current = duration;\r\n            }\r\n            this.controls.mediaPlayer[0].currentTime = current;\r\n        },\r\n\r\n        getCoords: function(elem) {\r\n            var box = elem.getBoundingClientRect();\r\n\r\n            return {\r\n                top: box.top + pageYOffset,\r\n                left: box.left + pageXOffset\r\n            };\r\n\r\n        },\r\n\r\n        registerEvents: function(){\r\n\r\n            var c = this.controls;\r\n            var that = this;\r\n\r\n            c.playBtn.click(function(e) {\r\n                e.preventDefault();\r\n                var readyState = c.mediaPlayer[0].readyState;\r\n\r\n                if (readyState == '4') {\r\n                    if (c.playBtn.hasClass('playing')) {\r\n                        c.mediaPlayer[0].pause();\r\n                    } else {\r\n                        c.mediaPlayer[0].play();\r\n                    }\r\n\r\n                    c.playBtn.toggleClass('playing');\r\n                } else {\r\n                    alert('No media..');\r\n                }\r\n\r\n\r\n\r\n            });\r\n\r\n            c.prevBtn.click(function(e) {\r\n                e.preventDefault();\r\n                that.stepBack();\r\n            });\r\n\r\n            c.nextBtn.click(function(e) {\r\n                e.preventDefault();\r\n                that.stepForward();\r\n            });\r\n\r\n            c.progressLine.click(function(e) {\r\n                e.preventDefault();\r\n\r\n                var $target = $(e.target);\r\n\r\n                if ($target.hasClass('progress-marker')) {\r\n                    return false;\r\n                }\r\n\r\n                var progressVal = e.offsetX;\r\n                var barWidth = c.progressLine.width();\r\n                var positionRatio = progressVal / barWidth;\r\n                var progressCurrent = positionRatio * 100;\r\n\r\n                c.greenProgress.width(progressCurrent + '%');\r\n                c.progressMarker.css(\r\n                    {\r\n                        left: progressCurrent + '%',\r\n                        opacity: 1\r\n                    }\r\n                );\r\n\r\n                c.mediaPlayer[0].currentTime = c.mediaDuration * positionRatio;\r\n\r\n                var durationCurrent = new Date(0, 0, 0, 0, 0, 0, c.mediaDuration * positionRatio * 1000);\r\n                c.timeCurrent.text(that.toTimeString(durationCurrent));\r\n\r\n            });\r\n\r\n            c.mediaPlayer.on('loadeddata', function(e) {\r\n                c.mediaDuration = c.mediaPlayer[0].duration;\r\n                if(!isNaN(c.mediaDuration) && isFinite(c.mediaDuration)){\r\n                    var duration = new Date(0, 0, 0, 0, 0, 0, c.mediaDuration * 1000);\r\n                    c.timeTotal.text(that.toTimeString(duration));\r\n                }\r\n\r\n                c.timeCurrent.text('0:00');\r\n\r\n                //init progress marker\r\n                c.progressMarker.css(\r\n                    {\r\n                        left: '0%',\r\n                        opacity: 1\r\n                    }\r\n                );\r\n\r\n                //add the timeupdate event. If you add this before now, it fails cos no media was loaded\r\n                c.mediaPlayer.on('timeupdate', function (ex) {\r\n                    // Update progress bar\r\n                    var video = c.mediaPlayer[0];\r\n                    var durationRatio = video.currentTime / video.duration;\r\n                    var leftPosition = durationRatio * 100 + '%';\r\n\r\n                    c.greenProgress.width(leftPosition);\r\n                    c.progressMarker.css(\r\n                        {\r\n                            left: leftPosition,\r\n                            opacity: 1\r\n\r\n                        }\r\n                    );\r\n\r\n                    // Update playback duration\r\n                    var currentTime = new Date(0, 0, 0, 0, 0, 0, video.currentTime * 1000);\r\n                    currentTime = that.toTimeString(currentTime);\r\n                    c.timeCurrent.text(currentTime);\r\n\r\n                });\r\n            });\r\n\r\n            c.mediaPlayer.on('durationchange', function(e) {\r\n                c.mediaDuration = c.mediaPlayer[0].duration;\r\n                if(!isNaN(c.mediaDuration) && isFinite(c.mediaDuration)){\r\n                    var duration = new Date(0, 0, 0, 0, 0, 0, c.mediaDuration * 1000);\r\n                    c.timeTotal.text(that.toTimeString(duration));\r\n                }\r\n            });\r\n\r\n\r\n\r\n            var sliderElem = c.progressLine[0];\r\n            var thumbElem = c.progressMarker[0];\r\n\r\n            thumbElem.onmousedown = function(e) {\r\n\r\n                var sliderCoords = that.getCoords(sliderElem);\r\n\r\n                document.onmousemove = function(e) {\r\n                    var newLeft = e.pageX - sliderCoords.left;\r\n\r\n                    if (newLeft < 0) {\r\n                        newLeft = 0;\r\n                    }\r\n                    var rightEdge = sliderElem.offsetWidth;\r\n\r\n                    if (newLeft > rightEdge) {\r\n                        newLeft = rightEdge;\r\n                    }\r\n\r\n                    thumbElem.style.left = newLeft + 'px';\r\n                    c.greenProgress.width(newLeft + 'px');\r\n\r\n                    c.mediaPlayer[0].currentTime = c.mediaDuration * (newLeft / rightEdge);\r\n\r\n                    var durationCurrent = new Date(0, 0, 0, 0, 0, 0, c.mediaDuration * (newLeft / rightEdge) * 1000);\r\n                    c.timeCurrent.text(that.toTimeString(durationCurrent));\r\n\r\n                }\r\n\r\n                document.onmouseup = function(e) {\r\n                    document.onmousemove = document.onmouseup = null;\r\n                };\r\n\r\n            };\r\n\r\n            thumbElem.ondragstart = function() {\r\n                return false;\r\n            };\r\n\r\n        }//end of register events\r\n}//end of returned object\r\n\r\n});\r\n"],"names":["define","$","constants","controls","init","mediatype","initControls","registerEvents","mediatype_video","mediaPlayer","videoplayer","audioplayer","playBtn","playbutton","prevBtn","prevbutton","nextBtn","nextbutton","progressBar","progressbar","progressLine","progressline","greenProgress","greenprogress","progressMarker","progressmarker","mediaDuration","timeTotal","timetotal","timeCurrent","timecurrent","toTimeString","date","split","slice","moveSlider","event","stepBack","current","this","currentTime","stepForward","duration","getCoords","elem","box","getBoundingClientRect","top","pageYOffset","left","pageXOffset","c","that","click","e","preventDefault","readyState","hasClass","pause","play","toggleClass","alert","target","positionRatio","offsetX","width","progressCurrent","css","opacity","durationCurrent","Date","text","on","isNaN","isFinite","ex","video","leftPosition","sliderElem","thumbElem","onmousedown","sliderCoords","document","onmousemove","newLeft","pageX","rightEdge","offsetWidth","style","onmouseup","ondragstart"],"mappings":"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"}