define(["jquery","mod_pchat/conversationconstants"],function(a,b){return{controls:{},init:function(a){this.initControls(a),this.registerEvents()},initControls:function(c){c===b.mediatype_video?this.controls.mediaPlayer=a(b.videoplayer):this.controls.mediaPlayer=a(b.audioplayer),this.controls.playBtn=a(b.playbutton),this.controls.prevBtn=a(b.prevbutton),this.controls.nextBtn=a(b.nextbutton),this.controls.progressBar=a(b.progressbar),this.controls.progressLine=a(b.progressline),this.controls.greenProgress=a(b.greenprogress),this.controls.progressMarker=a(b.progressmarker),this.controls.mediaDuration=0,this.controls.timeTotal=a(b.timetotal),this.controls.timeCurrent=a(b.timecurrent)},toTimeString:function(a){var a=a.toTimeString().split(" ")[0];return a=a.slice(3,8)},moveSlider:function(a){},stepBack:function(){var a=this.controls.mediaPlayer[0].currentTime;a>5?a-=5:a=0,this.controls.mediaPlayer[0].currentTime=a},stepForward:function(){var a=this.controls.mediaPlayer[0].currentTime,b=this.controls.mediaPlayer[0].duration;a<=b-5?a+=5:a=b,this.controls.mediaPlayer[0].currentTime=a},getCoords:function(a){var b=a.getBoundingClientRect();return{top:b.top+pageYOffset,left:b.left+pageXOffset}},registerEvents:function(){var b=this.controls,c=this;b.playBtn.click(function(a){a.preventDefault();var c=b.mediaPlayer[0].readyState;"4"==c?(b.playBtn.hasClass("playing")?b.mediaPlayer[0].pause():b.mediaPlayer[0].play(),b.playBtn.toggleClass("playing")):alert("No media..")}),b.prevBtn.click(function(a){a.preventDefault(),c.stepBack()}),b.nextBtn.click(function(a){a.preventDefault(),c.stepForward()}),b.progressLine.click(function(d){d.preventDefault();var e=a(d.target);if(e.hasClass("progress-marker"))return!1;var f=d.offsetX,g=b.progressLine.width(),h=f/g,i=100*h;b.greenProgress.width(i+"%"),b.progressMarker.css({left:i+"%",opacity:1}),b.mediaPlayer[0].currentTime=b.mediaDuration*h;var j=new Date(0,0,0,0,0,0,b.mediaDuration*h*1e3);b.timeCurrent.text(c.toTimeString(j))}),b.mediaPlayer.on("loadeddata",function(a){if(b.mediaDuration=b.mediaPlayer[0].duration,!isNaN(b.mediaDuration)&&isFinite(b.mediaDuration)){var d=new Date(0,0,0,0,0,0,1e3*b.mediaDuration);b.timeTotal.text(c.toTimeString(d))}b.timeCurrent.text("0:00"),b.progressMarker.css({left:"0%",opacity:1}),b.mediaPlayer.on("timeupdate",function(a){var d=b.mediaPlayer[0],e=d.currentTime/d.duration,f=100*e+"%";b.greenProgress.width(f),b.progressMarker.css({left:f,opacity:1});var g=new Date(0,0,0,0,0,0,1e3*d.currentTime);g=c.toTimeString(g),b.timeCurrent.text(g)})}),b.mediaPlayer.on("durationchange",function(a){if(b.mediaDuration=b.mediaPlayer[0].duration,!isNaN(b.mediaDuration)&&isFinite(b.mediaDuration)){var d=new Date(0,0,0,0,0,0,1e3*b.mediaDuration);b.timeTotal.text(c.toTimeString(d))}});var d=b.progressLine[0],e=b.progressMarker[0];e.onmousedown=function(a){var f=c.getCoords(d);document.onmousemove=function(a){var g=a.pageX-f.left;g<0&&(g=0);var h=d.offsetWidth;g>h&&(g=h),e.style.left=g+"px",b.greenProgress.width(g+"px"),b.mediaPlayer[0].currentTime=b.mediaDuration*(g/h);var i=new Date(0,0,0,0,0,0,b.mediaDuration*(g/h)*1e3);b.timeCurrent.text(c.toTimeString(i))},document.onmouseup=function(a){document.onmousemove=document.onmouseup=null}},e.ondragstart=function(){return!1}}}});